<ion-content [class.dark]="isDarkMode" class="goals-content">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <ion-button fill="clear" (click)="goBack()" class="back-btn">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
      <h1>Minhas Metas</h1>
      <div class="header-actions">
        <ion-button fill="clear" (click)="openAddGoalModal()" class="add-btn">
          <ion-icon name="add" slot="icon-only"></ion-icon>
        </ion-button>
      </div>
    </div>
  </div>

  <!-- Add Goal Button -->
  <div class="add-goal-section">
    <ion-button 
      expand="block" 
      (click)="openAddGoalModal()"
      class="add-goal-btn">
      <ion-icon name="add" slot="start"></ion-icon>
      Nova Meta
    </ion-button>
  </div>

  <!-- Goals List -->
  <div class="goals-list">
    <div *ngIf="getGoals().length === 0" class="empty-state">
      <ion-icon name="flag"></ion-icon>
      <h4>Nenhuma meta criada</h4>
      <p>Crie sua primeira meta para começar a economizar</p>
    </div>
    
    <div *ngFor="let goal of getGoals()" class="goal-item" [class.completed]="isGoalCompleted(goal)">
      <div class="goal-header">
        <div class="goal-image">
          <img *ngIf="goal.image" [src]="goal.image" [alt]="goal.title">
          <ion-icon *ngIf="!goal.image" name="flag"></ion-icon>
        </div>
        <div class="goal-info">
          <div class="goal-title">{{ goal.title }}</div>
          <div *ngIf="goal.description" class="goal-description">{{ goal.description }}</div>
        </div>
      </div>
      
      <div class="goal-progress">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getGoalProgress(goal)"></div>
        </div>
        <div class="goal-amounts">
          <span class="goal-current">{{ formatCurrency(goal.current) }}</span>
          <span class="goal-percentage">{{ getGoalProgress(goal).toFixed(1) }}%</span>
          <span class="goal-target">{{ formatCurrency(goal.target) }}</span>
        </div>
      </div>
      
      <div class="goal-actions">
        <ion-button fill="outline" (click)="openAddMoneyModal(goal)" class="add-money-btn">
          <ion-icon name="add" slot="start"></ion-icon>
          Adicionar
        </ion-button>
        <ion-button fill="outline" (click)="deleteGoal(goal)" class="delete-goal-btn">
          <ion-icon name="trash" slot="start"></ion-icon>
          Excluir
        </ion-button>
      </div>
    </div>
  </div>

  <!-- Add Goal Modal -->
  <div class="modal-overlay" *ngIf="showAddGoalModal" (click)="closeAddGoalModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Nova Meta</h3>
        <ion-button fill="clear" (click)="closeAddGoalModal()" class="close-btn">
          <ion-icon name="close" slot="icon-only"></ion-icon>
        </ion-button>
      </div>
      
      <form [formGroup]="goalForm" (ngSubmit)="onSubmitGoal()" class="goal-form">
        <ion-item class="form-item">
          <ion-label position="stacked">Título da Meta</ion-label>
          <ion-input 
            formControlName="title" 
            placeholder="Ex: Viagem para Europa"
            type="text">
          </ion-input>
        </ion-item>
        
        <ion-item class="form-item">
          <ion-label position="stacked">Descrição (opcional)</ion-label>
          <ion-textarea 
            formControlName="description" 
            placeholder="Descreva sua meta..."
            rows="3">
          </ion-textarea>
        </ion-item>
        
        <ion-item class="form-item">
          <ion-label position="stacked">Valor da Meta</ion-label>
          <ion-input 
            formControlName="target" 
            placeholder="0,00"
            type="number"
            step="0.01">
          </ion-input>
        </ion-item>
        
        <ion-item class="form-item">
          <ion-label position="stacked">Imagem (opcional)</ion-label>
          <input 
            type="file" 
            id="goalImage" 
            accept="image/*" 
            (change)="onImageSelected($event)"
            class="file-input">
        </ion-item>
        
        <div *ngIf="selectedImage" class="image-preview">
          <img [src]="selectedImage" alt="Preview">
          <ion-button fill="clear" (click)="removeImage()" class="remove-image-btn">
            <ion-icon name="close" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
        
        <div class="form-actions">
          <ion-button fill="outline" (click)="closeAddGoalModal()" class="btn-secondary">
            Cancelar
          </ion-button>
          <ion-button type="submit" [disabled]="!goalForm.valid" class="btn-primary">
            Criar Meta
          </ion-button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Money Modal -->
  <div class="modal-overlay" *ngIf="showAddMoneyModal" (click)="closeAddMoneyModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Adicionar Dinheiro</h3>
        <ion-button fill="clear" (click)="closeAddMoneyModal()" class="close-btn">
          <ion-icon name="close" slot="icon-only"></ion-icon>
        </ion-button>
      </div>
      
      <form [formGroup]="addMoneyForm" (ngSubmit)="onSubmitAddMoney()" class="add-money-form">
        <div *ngIf="currentGoalForMoney" class="goal-info">
          <h4>Meta: {{ currentGoalForMoney.title }}</h4>
          <p>Progresso atual: {{ formatCurrency(currentGoalForMoney.current) }} de {{ formatCurrency(currentGoalForMoney.target) }}</p>
        </div>
        
        <ion-item class="form-item">
          <ion-label position="stacked">Valor a adicionar</ion-label>
          <ion-input 
            formControlName="amount" 
            placeholder="0,00"
            type="number"
            step="0.01">
          </ion-input>
        </ion-item>
        
        <div class="form-actions">
          <ion-button fill="outline" (click)="closeAddMoneyModal()" class="btn-secondary">
            Cancelar
          </ion-button>
          <ion-button type="submit" [disabled]="!addMoneyForm.valid" class="btn-primary">
            Adicionar
          </ion-button>
        </div>
      </form>
    </div>
  </div>
</ion-content>
